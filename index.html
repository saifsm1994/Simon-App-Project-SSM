<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Simon Game, updated to bootstrap 4">
    <meta name="author" content="saifsm1994">
    <link rel="shortcut icon" href=favicon.ico>

    <title>Simon Game V2</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/simonGame.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>
        body {
            padding-top: 54px;
        }

        @media (min-width: 992px) {
            body {
                padding-top: 56px;
            }
        }
    </style>
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://rawgithub.com/darkskyapp/skycons/master/skycons.js "></script>

</head>


<body class="bodyOfThePage">


    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">by Saif Mustafa</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="/">Home
                <span class="sr-only">(current)</span>
              </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">About</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="/" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Portfolio</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item disabled" style="color: darkgrey;">Backend Projects+</a>
                            <a class="dropdown-item" href="/solarEstimator.html">EasySolarEstimator</a>
                            <a class="dropdown-item" href="#">Voting App</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item disabled" style="color: darkgrey;">Front End Projects</a>
                            <a class="dropdown-item" href="/projects/simonGame/index.html">Simon Game App</a>
                            <a class="dropdown-item" href="/projects/javascriptCalculator/index.html">Pure Javascript Calculator App</a>
                            <a class="dropdown-item" href="/projects/weather/index.html">Weather App</a>
                            <a class="dropdown-item" href="/projects/wikipediaViewer/index.html">Wikipedia Search App</a>
                        </div>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Page Content -->
    <div class="overlay">
        <div id="loading-img"></div>
    </div>

    <div id="bodyOfThePage">

        <div class="container">
            <div id="simonConsole">
                <div id="0" class="green simonPad leftHalf " onclick="playerClick(0); verifyNewChoice(0);    "></div>
                <div id="1" class="red simonPad" onclick=" playerClick(1); verifyNewChoice(1);  "></div>
                <div id="2" class="yellow simonPad leftHalf lowerHalf" onclick="playerClick(2); verifyNewChoice(2);     "></div>
                <div id="3" class="blue simonPad lowerHalf" onclick="playerClick(3);   verifyNewChoice(3);   "></div>



                <div id="middleCircle">
                    <div id="titleSimon">
                        <h1 id="titleSimonText">Simon<sup id="trademark">&reg;</sup> </h1>
                    </div>
                    <div class="row" id="displayRow">
                        <div id="countDisplay" class="col-xs-4 offset-1">
                            <input type="number" id="counterDisplayer" class="counterDisplayer" placeholder="00" readonly>
                            <h3>Count</h3>
                        </div>
                        <div class="col-xs-3 offset-1">
                            <button class="greenButton" onClick="aIRun();"></button>
                            <div id="start">
                                <h3>Start</h3>
                            </div>
                        </div>
                        <div class="col-xs-4 offset-1">
                            <div>
                                <button class="redButton" onclick="enablestricter();"></button>
                                <div id="strict">
                                    <h3>Strict <sup><input id="lightDisplay" type="number" class="lightDisplay" readonly></sup></h3>
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="row">
                        <div class="offset-6" style="margin-top: -10px;">
                            <label class="switch">
                      <input id="onOffSwitch" type="checkbox" onclick="resetter();">
                    <span class="slider round"></span>
                    </label></div>
                    </div>

                </div>

            </div>
        </div>
        <!--    <h1 onclick="aiSelect(0)">Hello, world!</h1>-->

    </div>

    <script>
        $(document).ready(function() {
            $('[data-toggle="dropdown"]').dropdown();
        });
        //List of functions and features
        //aIRun makes the ai add a new choice if running is set to 0 && flashes all current aiChoices
        //aiSelect is how the ai flashes the choices 
        //playsound plays the corresponding sound for each revertColor
        //revert color runs at the end and removes the flash class
        // doSetTimeout delays the ai flashes so they don't all occur at once   
        // verifyNewChoices takes the player click as an input, adds it to a set of player choices, and makes sure it is the right selection else failure
        //failure, - if strict resets everything and runs the ai, if not strict resets the player and runs ai
        //isOn checks if the on switch is checked else nothing runs



        //Global
        var c = 1000; //Timing control - reduce number to speed up
        var aiChoices = []; // holds the old ai choices
        var playerChoices = []; // holds current player choices
        var playerStepCount = 0; //tracks how many steps the player has taken
        var stricter = 0; //strict mode or not, 0 = off
        var running = 0; // prevents double running
        var isAiRunning = 0;
        var aiStepCounter = 0; // Used to track ai moves, reactivate board once finished
        var hasGameStarted = 0; //stops board from working unless game started
        //var isSimonOn = 0;



        //Operational Functions
        //Operational Functions
        //Operational Functions
        function isOn() {
            if (document.getElementById("onOffSwitch").checked) {
                return true;
            } else {
                return false;
            }
        }

        //Holds and plays all sounds
        function playSound(a) {
            var green = new Audio("https://s3.amazonaws.com/freecodecamp/simonSound1.mp3");
            var red = new Audio('https://s3.amazonaws.com/freecodecamp/simonSound2.mp3');
            var yellow = new Audio("https://s3.amazonaws.com/freecodecamp/simonSound3.mp3");
            var blue = new Audio("https://s3.amazonaws.com/freecodecamp/simonSound4.mp3");
            var winner = new Audio("http://cd.textfiles.com/cdaction/cdaction05a/LORDS2/FILES/FF_CAPT.WAV");
            var loser = new Audio("http://www.acc.umu.se/~snow/ljud/trumpet.wav");
            //    console.log(a); http://sep800.mine.nu/files/sounds/fanfare2.wav

            if (a == "green") {
                green.play();
            }
            if (a == "red") {
                red.play();
            }
            if (a == "yellow") {
                yellow.play();
            }
            if (a == "blue") {
                blue.play();
            }
            if (a == "winner") {
                winner.play();
            }
            if (a == "loser") {
                loser.play();
            }


        }



        //used to trigger buttons and noise when the ai has selected a button
        function aiSelect(a) {
            //    console.log("aiselect ==   " + a);
            setTimeout(function() {
                if (a == 0) {
                    var greenButton = document.getElementById("0");
                    //        greenButton.click();
                    greenButton.classList.add("liteGreen");
                    revertColor(greenButton, 'greenButton');
                    playSound("green");
                }
                if (a == 1) {
                    var redButton = document.getElementById("1");
                    //        redButton.click();
                    redButton.classList.add("liteRed");
                    revertColor(redButton, 'redButton');
                    playSound("red");
                }

                if (a == 2) {
                    var yellowButton = document.getElementById("2");
                    //        yellowButton.click();
                    yellowButton.classList.add("liteYellow");
                    revertColor(yellowButton, 'yellowButton');
                    playSound("yellow");
                }

                if (a == 3) {
                    var blueButton = document.getElementById("3");
                    //        blueButton.click();
                    blueButton.classList.add("liteBlue");
                    revertColor(blueButton, 'blueButton');
                    playSound("blue");
                }

            }, 2);
            return;
        }


        //subFunction runs to undo the trigger from aiSelect
        function revertColor(a, b) {
            //    console.log(a);
            setTimeout(function() {
                if (b == "greenButton") {
                    a.classList.remove("liteGreen");
                    //        console.log('running0');
                }
                if (b == "redButton") {
                    a.classList.remove("liteRed");
                    //        console.log('runnin1');
                }
                if (b == "yellowButton") {
                    a.classList.remove("liteYellow");
                    //        console.log('running2');
                }
                if (b == "blueButton") {
                    a.classList.remove("liteBlue");
                    //        console.log('running3');
                }
            }, c);

        }

        function playerClick(a) {
            if (isOn()) {
                //    if(hasGameStarted){
                if (isAiRunning === 0) {
                    if (a == 0) {
                        var greenButton = document.getElementById("0");
                        greenButton.classList.add("liteGreen");
                        revertColor(greenButton, 'greenButton');
                        playSound("green");
                    }
                    if (a == 1) {
                        var redButton = document.getElementById("1");
                        redButton.classList.add("liteRed");
                        revertColor(redButton, 'redButton');
                        playSound("red");
                    }
                    if (a == 2) {
                        var yellowButton = document.getElementById("2");
                        yellowButton.classList.add("liteYellow");
                        revertColor(yellowButton, 'yellowButton');
                        playSound("yellow");
                    }
                    if (a == 3) {
                        var blueButton = document.getElementById("3");
                        blueButton.classList.add("liteBlue");
                        revertColor(blueButton, 'blueButton');
                        playSound("blue");
                    }



                }
            }
        }
        //}


        //AI Running functions
        //AI Running functions
        //AI Running functions


        //runs all old choices and one new one
        function aIRun() {
            if (isOn()) {
                hasGameStarted = 1;
                if (isAiRunning === 0) {
                    isAiRunning = 1;
                    aiStepCounter = 0;
                    //starts if not running
                    if (running == 0) {
                        var newEntry = Math.floor(Math.random() * 4);
                        aiChoices.push(newEntry);
                        //    console.log("aichoices =     " + aiChoices);
                        running = 1;
                    }

                    var i = 0;

                    //for(var i =0;i<aiChoices.length;i++){
                    ////    setTimeout(function(x){ return function() {doSetTimeout(i)};}(i), 1000*i);        
                    //        
                    ////        function(i){doSetTimeout(i)},1000);

                    doSetTimeout(i);

                    if (aiStepCounter == aiChoices.length) {
                        console.log("player reactivated");
                        isAiRunning = 0;
                    } else {
                        //    console.log(aiStepCounter);
                    }


                    //    }


                    if (aiStepCounter == aiChoices.length) {
                        //        console.log("player reactivated");
                        isAiRunning = 0;
                    }
                }
            }
        }

        function doSetTimeout(i) {

            setTimeout(function(x) {
                return function() {
                    aiSelect(aiChoices[i]);
                    aiStepCounter = aiStepCounter + 1;
                    if (i < aiChoices.length) {
                        i = i + 1;
                        doSetTimeout(i);
                    }
                    if (aiStepCounter == aiChoices.length) {
                        //        console.log(c*i);
                        isAiRunning = 0;
                    }
                };
            }(i), c);


        }

        //Player Running Functions
        function verifyNewChoice(a) {
            if (isOn()) {
                if (hasGameStarted) {
                    if (isAiRunning === 0) {
                        checkLengthRecord();

                        playerChoices.push(a);
                        // new choice is added to the list.
                        var currentPos = playerChoices.length;
                        // this now equals 1 + the legnth of the set.
                        currentPos = currentPos - 1;

                        //Note only checks the latest value

                        if (playerChoices[currentPos] !== aiChoices[currentPos]) {

                            //forces the player to restart from the start
                            failure();
                        } else {

                            if (playerChoices.length == aiChoices.length) {
                                playerChoices = [];
                                //if the latest value is equal to the corresponding value in the ai choice set
                                running = 0;
                                // allows for new points to be picked
                                aIRun();
                                //picks a new point
                                checkLengthRecord();
                            }
                        }
                    } else {}
                }
            }
        }

        ////Unneeded function, rendered moot. Will be removed later //
        function checkLengthRecord() {
            updateCounter();
        }

        function updateCounter() {

            var countValue = document.getElementById('counterDisplayer').placeholder;
            if (playerChoices.length >= countValue) {
                countValueUpdate = aiChoices.length;
                document.getElementById('counterDisplayer').placeholder = countValueUpdate;
                console.log("Highest number of rounds " + countValueUpdate);
            }
            //    console.log(countValue);
            if (countValue >= 4) {
                c = 800;
            }
            if (countValue >= 6) {
                c = 700;
            }
            if (countValue >= 12) {
                c = 600;
            }
            if (countValue >= 15) {
                c = 500;
            }
            if (countValue == 20) {
                playSound("winner");
            }
        }

        function enablestricter() {
            if (stricter == 0) {
                stricter = 1;
                document.getElementById('lightDisplay').classList.add('greenLight');
            } else {
                stricter = 0;
                document.getElementById('lightDisplay').classList.remove('greenLight');
            }
        }

        function failure() {
            //    alert("Failure");
            playSound("loser");
            setTimeout(function() {
                if (stricter) {
                    aiChoices = [];
                    playerChoices = [];
                    playerStepCount = [];
                    running = 0;
                    aIRun();
                    var countValue = document.getElementById('counterDisplayer').innerHTML;
                    document.getElementById('counterDisplayer').placeholder = 00;
                }

                if (!stricter) {
                    playerChoices = [];
                    playerStepCount = [];
                    aIRun();

                }

            }, 4000)

        }

        //failure without the noise
        function resetter() {
            aiChoices = [];
            playerChoices = [];
            playerStepCount = [];
            running = 0;
            var countValue = document.getElementById('counterDisplayer').innerHTML;
            document.getElementById('counterDisplayer').placeholder = 00;
        }
    </script>






</body>

</html>
